@page "/"
@using RegexReplacer.Client.Helper
@using System.Text.RegularExpressions
@using RegexReplacer.Shared
@inject IJSRuntime jsRuntime

<PageTitle>Regex Replacer</PageTitle>

<RadzenSplitter class="full-h, full-w">
    <RadzenSplitterPane Size="40%" Min="30px" Max="90%">
        <RadzenTextArea @bind-Value=@input class="full-h, full-w" @oninput=@(args => OnChange(args.Value?.ToString()))></RadzenTextArea>
    </RadzenSplitterPane>
    <RadzenSplitterPane Size="20%" Min="30px" Max="90%">
        <RadzenDropDown AllowClear="true" AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                        Placeholder="Select Rule Set..." Multiple="true" Class="full-w" SelectedItemChanged=@((args) => OnChange())
                        @bind-Value=@selectedRuleSets Data=@ruleSets TextProperty="Name" />

        <RadzenDropDown AllowClear="true" AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                        Placeholder="Select Option..." Multiple="true" Class="full-w" SelectedItemChanged=@((args) => OnChange())
                        @bind-Value=@selectedOptions Data=@regexOptions />
    </RadzenSplitterPane>
    <RadzenSplitterPane Size="40%" Min="30px" Max="90%">
        <RadzenTextArea @bind-Value=@output ReadOnly=true class="full-h, full-w"></RadzenTextArea>
    </RadzenSplitterPane>
</RadzenSplitter>

@code
{
    string input = "";
    string output = "";

    RuleSetHelper? ruleSetHelper;

    List<RegexOptions> regexOptions = EnumHelper.GetEnums<RegexOptions>();
    List<RegexOptions> selectedOptions = new() { RegexOptions.IgnoreCase };

    List<RuleSet> ruleSets = new();
    List<RuleSet> selectedRuleSets = new();

    protected override async Task OnInitializedAsync()
    {
        ruleSetHelper = await RuleSetHelper.GetRuleSetHelper(jsRuntime);
        ruleSets = ruleSetHelper.RuleSets;
        selectedRuleSets = ruleSets.ToList();

        await base.OnInitializedAsync();
    }

    public void OnChange(string? newInput = null)
    {
        if (ruleSetHelper == null)
            return;

        if(newInput != null)
        {
            input = newInput;            
        }

        output = ruleSetHelper.Generate(input, selectedRuleSets.ToList(), selectedOptions);
    }
}